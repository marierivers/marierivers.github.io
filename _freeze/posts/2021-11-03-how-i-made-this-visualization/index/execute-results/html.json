{
  "hash": "5dc7ec95b7a4376f874c640d48fe61f5",
  "result": {
    "markdown": "---\ntitle: \"How I made this visualization\"\ndescription: \"Visualization of Alaska household languages data\"\nauthor:\n  - name: Marie Rivers\n    url: https://marierivers.github.io/\ndate: 2021-11-03\ncategories: [R, data visualization]\ncitation: \n  url: https://marierivers.github.io/posts/2021-11-03-how-i-made-this-visualization/ \nimage: only_english_plot.png\ndraft: false\n---\n\nAn assignment for my Metadata Standards, Data Modeling and Data Semantics class included using the [`metajam` R package](https://cran.r-project.org/web/packages/metajam/metajam.pdf) to download [Alaskan household languages data and metadata](https://knb.ecoinformatics.org/view/doi:10.5063/F1N58JPP) from knb. After reviewing the metadata and reading the data into R, we were tasked with writing code to compute the percentage of Alaskan households that only speak English for the years 2009-2015 and visualizing these results...a straightforward task.\n\nBut...as I reviewed the numbers I thought about what I actually wanted to capture in the visualization. Did I want to focus on changes over time? There was a slight trend, but nothing significant. The data included State of Alaska Salmon and People Regions (SASAP) so I wanted to show any regional differences.\n\nHere's the final visualization\n\n![](only_english_plot.png)\n\nThe items below outline my data visualization process and helpful resources. Full code for data processing and visualization are included at the end.\n\n### 1. Heatmap with geom_tile( )\n\nA line graph showing change in time would not have been very interesting, but I didn't want to exclude the time component by just creating a bar chart of each group. The heatmap tiles provided an efficent way to capture regional differences, subtle changes in time, and percentages of household that only speak English. \n\nResource: [Allison Horst's Advanced Data Visualization in ggplot2](https://allisonhorst.github.io/rice-data-viz/)\n\n### 2. Ordering the data\n\nI used `fct_reorder` to sort the SASAP regions by average percent of households that only spoke English\n\n`mutate(SASAP.Region = fct_reorder(SASAP.Region, percent_only_english, .fun = mean))`\n\n### 3. Text within tiles\nThis line of code rounded the calculated values and displayed white text with a % symbol\n\n`geom_text(aes(label = paste0(round(avg_percent_english, 0),\"%\")), color = \"white\", size = 3)`\n\n### 4. Picking colors\n\nThis might have been the hardest part. I played around with the number and shade of colors and settled on shades of gray, blue, green and reddish brown with a `scale_fill_gradientn` gradient. `geom_tile(aes(fill = avg_percent_english), show.legend = TRUE)`\n\nThe [NCEAS R color cheatsheet](https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf) was helpful for getting color names. Useful information on gradient color scales was found in the book [ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/scale-colour.html) and [ggplot2 documentation](https://ggplot2.tidyverse.org/reference/scale_gradient.html)\n\n### 5. legend title\n\n`labs(fill = \"Percent\")` \n\nResource: [Editing legend (text) labels in ggplot](https://stackoverflow.com/questions/23635662/editing-legend-text-labels-in-ggplot)\n\n### 6. x-axis\n\nWhile there are more elegant ways set axis divisions for dates, I opted for a simple vector of years. `scale_x_discrete(name = \"Year\", limits = c(2009, 2010, 2011, 2012, 2013, 2014, 2015))`\n\n### 7. Remove gridlines\n\n`theme(panel.grid.major = element_blank())` \n\nResource: [Remove grid and background from plot (ggplot2)](https://felixfan.github.io/ggplot2-remove-grid-background-margin/)\n\n### 8. Move title and caption from panel to plot area\n\n`theme(plot.caption = element_text(size = 8, hjust = 0), plot.caption.position = \"plot\") + theme(plot.title.position = \"plot\")`\n\nResource: [Changing position of plot captions](https://community.rstudio.com/t/changing-position-of-plot-captions/108973)\n\n## Download data using `metajam`\n\n::: {.cell}\n\n```{.r .cell-code}\n# url to csv file\ndata_url <- \"https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn%3Auuid%3A7fc6f6db-c5ea-426a-a743-1f2edafb43b8\"\n\n# download the data and metadata to project folder\ndata_path <- metajam::download_d1_data(data_url, \"~/Documents/metajam_example\")\n\n# Read the data and metadata\nhh_list <- metajam::read_d1_files(data_path)\n\n# get the household data frame\nhh_data <- hh_list$data\n\n# get the attribute (columns) metadata\nhh_att_metadata <- hh_list$attribute_metadata\n```\n:::\n\n## Tidy Data\n\n#### Code used to process the data\n\nI adjusted the original data processing code as my plan for the visualization evolved\n\n::: {.cell}\n\n```{.r .cell-code}\nhousehold_language <- read_csv(here(\"data\", \"doi_10.5063_F1CJ8BPH__household_language__csv\", \"household_language.csv\"))\n\nhh_data_english <- household_language %>%\n  filter(Year >= 2009) %>%\n  filter(total > 0) %>%\n  mutate(percent_only_english = (speak_only_english / total) * 100) %>%\n  relocate(percent_only_english, .before = german) %>%\n  mutate(SASAP.Region = fct_reorder(SASAP.Region, percent_only_english, .fun = mean)) %>%\n  group_by(SASAP.Region, Year) %>%\n  summarise(avg_percent_english = mean(percent_only_english))\n```\n:::\n\n## ggplot\n\nCode used to create the plot\n\n::: {.cell}\n\n```{.r .cell-code}\nonly_english_plot <- ggplot(hh_data_english, aes(x = Year, y = SASAP.Region)) +\n  geom_tile(aes(fill = avg_percent_english), show.legend = TRUE) +\n  geom_text(aes(label = paste0(round(avg_percent_english, 0),\"%\")), color = \"white\", size = 3) +\n  scale_fill_gradientn(colors = c(\"antiquewhite3\", \"antiquewhite4\", \"steelblue4\", \"springgreen4\", \"indianred4\")) +\n  theme_minimal() +\n  theme(panel.grid.major = element_blank()) +\n  labs(x = \"Year\", y = NULL,\n       fill = \"Percent\",\n       title = \"Percent of Alaska Households that Only Speak English\",\n       subtitle = \"based on State of Alaska Salmon and People Region\",\n       caption = \"source: Jeanette Clark, Sharis Ochs, Derek Strong, and National Historic Geographic Information System. 2018.\\nLanguages used in Alaskan households, 1990-2015. urn:node:KNB. doi:10.5063/F1N58JPP\") +\n  theme(plot.caption = element_text(size = 8, hjust = 0),\n        plot.caption.position = \"plot\") +\n  theme(plot.title.position = \"plot\") +\n  scale_x_discrete(name = \"Year\", limits = c(2009, 2010, 2011, 2012, 2013, 2014, 2015))\n```\n:::\n\n**Data citation:** Jeanette Clark, Sharis Ochs, Derek Strong, and National Historic Geographic Information System. 2018. Languages used in Alaskan households, 1990-2015. <urn:node:KNB>. <doi:10.5063/F1N58JPP>.\n\n<https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn%3Auuid%3A7fc6f6db-c5ea-426a-a743-1f2edafb43b8>\"",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": [],
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}