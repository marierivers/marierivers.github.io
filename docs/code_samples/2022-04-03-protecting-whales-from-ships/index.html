<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.243">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Marie Rivers">
  <meta name="dcterms.date" content="2022-04-03">
  <meta name="description" content="A spatial analysis using Python and GeoPandas">
  <title>Marie Rivers - Protecting Whales from Ships</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../../">
  <script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link id="quarto-text-highlighting-styles" href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 3,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../styles.css">
</head>
<body class="floating nav-fixed">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Marie Rivers</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code_samples.html">Code Samples</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">Posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../data/rivers_marie_resume.pdf">Resume</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/marierivers"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">



<div class="quarto-title-banner color-navbar page-columns page-full"><div class="quarto-title column-body"><div class="quarto-title-block"><div><h1 class="title">Protecting Whales from Ships</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> view code</button></div></div><div class="quarto-description"><p>A spatial analysis using Python and GeoPandas</p></div><div class="quarto-categories"><div class="quarto-category">Python</div><div class="quarto-category">geopandas</div><div class="quarto-category">statial analysis</div></div></div></div><div class="quarto-title-meta"><div><div class="quarto-title-meta-heading">Author</div><div class="quarto-title-meta-contents"><div class="quarto-title-authors"><div><a href="https://marierivers.github.io/">
<p>Marie Rivers</p>
</a></div></div></div></div><div><div class="quarto-title-meta-heading">Published</div><div class="quarto-title-meta-contents"><p class="date">April 3, 2022</p></div></div></div></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Contents</h2>
<ul>
<li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
<li><a href="#dominica-outline" id="toc-dominica-outline" class="nav-link" data-scroll-target="#dominica-outline">Dominica outline</a></li>
<li><a href="#plot-the-dominica-outline" id="toc-plot-the-dominica-outline" class="nav-link" data-scroll-target="#plot-the-dominica-outline">Plot the Dominica outline</a></li>
<li><a href="#whale-sighting-data" id="toc-whale-sighting-data" class="nav-link" data-scroll-target="#whale-sighting-data">Whale sighting data</a></li>
<li><a href="#create-grid" id="toc-create-grid" class="nav-link" data-scroll-target="#create-grid">Create grid</a></li>
<li><a href="#extract-whale-habitat" id="toc-extract-whale-habitat" class="nav-link" data-scroll-target="#extract-whale-habitat">Extract whale habitat</a></li>
<li><a href="#vessel-data" id="toc-vessel-data" class="nav-link" data-scroll-target="#vessel-data">Vessel data</a>
<ul class="collapse">
<li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
<li><a href="#calculate-distance-and-speed" id="toc-calculate-distance-and-speed" class="nav-link" data-scroll-target="#calculate-distance-and-speed">Calculate distance and speed</a></li>
</ul></li>
</ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">


<p data-sidebar-align="true">This analysis identifies a speed reduction zone off the island of Dominica for the purpose of reducing the occurrence of ships striking whales and quantifies the impact of reduced travel speeds on marine traffic.</p>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/marierivers/Library/r-miniconda/envs/r-reticulate/lib/python3.8/site-packages/geopandas/_compat.py:112: UserWarning: The Shapely GEOS version (3.10.3-CAPI-1.16.1) is incompatible with the GEOS version PyGEOS was compiled with (3.10.4-CAPI-1.16.2). Conversions between both will be slow.
  warnings.warn(</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapely</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygeos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dominica-outline" class="level1">
<h1>Dominica outline</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define path to folder</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>input_folder <span class="op">=</span> <span class="vs">r"data/dominica"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join folder path and filename </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> os.path.join(input_folder, <span class="st">"dma_admn_adm0_py_s1_dominode_v2.shp"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the full file path</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data/dominica/dma_admn_adm0_py_s1_dominode_v2.shp</code></pre>
</div>
</div>
<pre><code>data/dominica/dma_admn_adm0_py_s1_dominode_v2.shp</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read file using gpd.read_file()</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dominica <span class="op">=</span> gpd.read_file(fp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(dominica)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dominica.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ADM0_PCODE   ADM0_EN                                           geometry
0         DM  Dominica  POLYGON ((-61.43023 15.63952, -61.43019 15.639...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dominica.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change the projection to Dominica 1945 / British West Indies Grid (metric units)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>proj_area_crs <span class="op">=</span> <span class="dv">2002</span> <span class="co"># project area coordinate system EPSG code. Projected CRS for Dominica is 2002</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>dominica <span class="op">=</span> dominica.to_crs(epsg<span class="op">=</span>proj_area_crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dominica.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Derived Projected CRS: EPSG:2002&gt;
Name: Dominica 1945 / British West Indies Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Dominica - onshore.
- bounds: (-61.55, 15.14, -61.2, 15.69)
Coordinate Operation:
- name: British West Indies Grid
- method: Transverse Mercator
Datum: Dominica 1945
- Ellipsoid: Clarke 1880 (RGS)
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
</section>
<section id="plot-the-dominica-outline" class="level1">
<h1>Plot the Dominica outline</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> dominica.plot(color<span class="op">=</span><span class="st">"none"</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">9</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>dominica.crs.to_string())</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="whale-sighting-data" class="level1">
<h1>Whale sighting data</h1>
<p>Whale habitat was approximated using data from approximately 5,000 whale sightings between 2008 and 2015.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define path to folder</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>input_folder2 <span class="op">=</span> <span class="vs">r"data"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Join folder path and filename </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>fp2 <span class="op">=</span> os.path.join(input_folder2, <span class="st">"sightings2005_2018.csv"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the full file path</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data/sightings2005_2018.csv</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read file using gpd.read_file()</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>whales <span class="op">=</span> gpd.read_file(fp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(whales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>whales.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  field_1              GPStime          Lat          Long geometry
0       0  2005-01-15 07:43:27  15.36977117  -61.49328433     None
1       1  2005-01-15 08:07:13   15.3834075    -61.503702     None
2       2  2005-01-15 08:31:17  15.38106333  -61.50486067     None
3       3  2005-01-15 09:19:10  15.33532083  -61.46858117     None
4       4  2005-01-15 10:08:00    15.294224  -61.45318517     None</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap the geometries</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>whale_points <span class="op">=</span> gpd.points_from_xy(whales[<span class="st">'Long'</span>], whales[<span class="st">'Lat'</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>whale_gdf <span class="op">=</span> gpd.GeoDataFrame(whales, geometry<span class="op">=</span>whale_points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>whale_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  field_1              GPStime  ...          Long                    geometry
0       0  2005-01-15 07:43:27  ...  -61.49328433  POINT (-61.49328 15.36977)
1       1  2005-01-15 08:07:13  ...    -61.503702  POINT (-61.50370 15.38341)
2       2  2005-01-15 08:31:17  ...  -61.50486067  POINT (-61.50486 15.38106)
3       3  2005-01-15 09:19:10  ...  -61.46858117  POINT (-61.46858 15.33532)
4       4  2005-01-15 10:08:00  ...  -61.45318517  POINT (-61.45319 15.29422)

[5 rows x 5 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(whale_gdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># project the dataset into an appropriate CRS</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>whale_gdf <span class="op">=</span> whale_gdf.set_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>whale_gdf <span class="op">=</span> whale_gdf.to_crs(epsg<span class="op">=</span>proj_area_crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>whale_gdf.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Derived Projected CRS: EPSG:2002&gt;
Name: Dominica 1945 / British West Indies Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Dominica - onshore.
- bounds: (-61.55, 15.14, -61.2, 15.69)
Coordinate Operation:
- name: British West Indies Grid
- method: Transverse Mercator
Datum: Dominica 1945
- Ellipsoid: Clarke 1880 (RGS)
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>whale_gdf.plot(ax<span class="op">=</span>ax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="create-grid" class="level1">
<h1>Create grid</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>xmin, ymin, xmax, ymax <span class="op">=</span> whale_gdf.total_bounds</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>cell_size <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> <span class="bu">list</span>(np.arange(xmin, xmax <span class="op">+</span> width, width)) <span class="co"># return evenly spaced values starting at xmin, stopping (but not including) at xmax+width, by a step of width</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>ys <span class="op">=</span> <span class="bu">list</span>(np.arange(ymin, ymax <span class="op">+</span> length, length))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>xmin, ymin, xmax, ymax</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(408480.65208368783, 1532792.7459409237, 498500.3049570159, 1796964.3997029224)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to convert corner points into a cell polygon</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_cell(x, y, cell_size):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    ring <span class="op">=</span> [</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        (x, y),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        (x <span class="op">+</span> cell_size, y),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        (x <span class="op">+</span> cell_size, y <span class="op">+</span> cell_size),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        (x, y <span class="op">+</span> cell_size)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    cell <span class="op">=</span> shapely.geometry.Polygon(ring)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cell</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate over each combination of x and y coordinates in two nested for loops</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cells <span class="op">=</span> []</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> ys:</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        cell <span class="op">=</span> make_cell(x, y, cell_size)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        cells.append(cell)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> gpd.GeoDataFrame({<span class="st">'geometry'</span>:cells}, crs<span class="op">=</span>proj_area_crs)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#grid.to_file("grid.shp")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>grid.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                            geometry
0  POLYGON ((408480.652 1532792.746, 410480.652 1...
1  POLYGON ((408480.652 1534792.746, 410480.652 1...
2  POLYGON ((408480.652 1536792.746, 410480.652 1...
3  POLYGON ((408480.652 1538792.746, 410480.652 1...
4  POLYGON ((408480.652 1540792.746, 410480.652 1...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>grid.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Derived Projected CRS: EPSG:2002&gt;
Name: Dominica 1945 / British West Indies Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Dominica - onshore.
- bounds: (-61.55, 15.14, -61.2, 15.69)
Coordinate Operation:
- name: British West Indies Grid
- method: Transverse Mercator
Datum: Dominica 1945
- Ellipsoid: Clarke 1880 (RGS)
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>grid.boundary.plot(ax<span class="op">=</span>ax, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-28-3.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>whale_gdf.plot(ax<span class="op">=</span>base, facecolor<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>grid.boundary.plot(ax<span class="op">=</span>base, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>base, crs<span class="op">=</span>dominica.crs.to_string())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extract-whale-habitat" class="level1">
<h1>Extract whale habitat</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spatially join the grid with whale sighting data to count the number of sightings in each cell</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use an inner join since we're not interested in grid cells without any sightings</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>whale_grid <span class="op">=</span> grid.sjoin(whale_gdf, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>whale_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               geometry  ...         Long
124   POLYGON ((408480.652 1780792.746, 410480.652 1...  ...   -61.896866
124   POLYGON ((408480.652 1780792.746, 410480.652 1...  ...   -61.900766
124   POLYGON ((408480.652 1780792.746, 410480.652 1...  ...   -61.903366
125   POLYGON ((408480.652 1782792.746, 410480.652 1...  ...   -61.900116
125   POLYGON ((408480.652 1782792.746, 410480.652 1...  ...   -61.897716
...                                                 ...  ...          ...
5171  POLYGON ((484480.652 1690792.746, 486480.652 1...  ...   -61.194134
5172  POLYGON ((484480.652 1692792.746, 486480.652 1...  ...    -61.19188
6030  POLYGON ((498480.652 1532792.746, 500480.652 1...  ...  -61.0794355
6030  POLYGON ((498480.652 1532792.746, 500480.652 1...  ...  -61.0794355
6030  POLYGON ((498480.652 1532792.746, 500480.652 1...  ...  -61.0794355

[4893 rows x 6 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>whale_grid.boundary.plot(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>whale_grid.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Derived Projected CRS: EPSG:2002&gt;
Name: Dominica 1945 / British West Indies Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Dominica - onshore.
- bounds: (-61.55, 15.14, -61.2, 15.69)
Coordinate Operation:
- name: British West Indies Grid
- method: Transverse Mercator
Datum: Dominica 1945
- Ellipsoid: Clarke 1880 (RGS)
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'count'</span>] <span class="op">=</span> whale_grid.groupby(whale_grid.index).count()[<span class="st">'index_right'</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               geometry  count
0     POLYGON ((408480.652 1532792.746, 410480.652 1...    NaN
1     POLYGON ((408480.652 1534792.746, 410480.652 1...    NaN
2     POLYGON ((408480.652 1536792.746, 410480.652 1...    NaN
3     POLYGON ((408480.652 1538792.746, 410480.652 1...    NaN
4     POLYGON ((408480.652 1540792.746, 410480.652 1...    NaN
...                                                 ...    ...
6293  POLYGON ((500480.652 1790792.746, 502480.652 1...    NaN
6294  POLYGON ((500480.652 1792792.746, 502480.652 1...    NaN
6295  POLYGON ((500480.652 1794792.746, 502480.652 1...    NaN
6296  POLYGON ((500480.652 1796792.746, 502480.652 1...    NaN
6297  POLYGON ((500480.652 1798792.746, 502480.652 1...    NaN

[6298 rows x 2 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the grid dataframe to cells that have more than 20 sightings</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>whale_mask <span class="op">=</span> (grid[<span class="st">'count'</span>] <span class="op">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>whale_mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0       False
1       False
2       False
3       False
4       False
        ...  
6293    False
6294    False
6295    False
6296    False
6297    False
Name: count, Length: 6298, dtype: bool</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>whale_habitat <span class="op">=</span> grid[whale_mask]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone <span class="op">=</span> whale_habitat.unary_union.convex_hull</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;shapely.geometry.polygon.Polygon object at 0x7fb1914383d0&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(speed_reduction_zone)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># need to create a new GeoDataFrame with the speed_reduction_zone as a single feature</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'shapely.geometry.polygon.Polygon'&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone <span class="op">=</span> gpd.GeoDataFrame(index<span class="op">=</span>[<span class="dv">0</span>], crs<span class="op">=</span><span class="st">'epsg:2002'</span>, geometry<span class="op">=</span>[speed_reduction_zone])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Derived Projected CRS: EPSG:2002&gt;
Name: Dominica 1945 / British West Indies Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Dominica - onshore.
- bounds: (-61.55, 15.14, -61.2, 15.69)
Coordinate Operation:
- name: British West Indies Grid
- method: Transverse Mercator
Datum: Dominica 1945
- Ellipsoid: Clarke 1880 (RGS)
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(speed_reduction_zone)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.plot(ax<span class="op">=</span>base, facecolor<span class="op">=</span><span class="st">'lightgray'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>base, crs<span class="op">=</span>dominica.crs.to_string())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vessel-data" class="level1">
<h1>Vessel data</h1>
<p>Vessel data was obtained from Automatic Identification System (AIS) tranceivers from 2015.</p>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join folder path and filename </span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>fp3 <span class="op">=</span> os.path.join(input_folder2, <span class="st">"station1249.csv"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the full file path</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data/station1249.csv</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read file using gpd.read_file()</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>vessels <span class="op">=</span> gpd.read_file(fp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(vessels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>vessels.head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;bound method NDFrame.head of        field_1       MMSI        LON       LAT            TIMESTAMP geometry
0            0  233092000  -61.84788  15.23238  2015-05-22 13:53:26     None
1            1  255803280  -61.74397  15.96114  2015-05-22 13:52:57     None
2            2  329002300  -61.38968  15.29744  2015-05-22 13:52:32     None
3            3  257674000  -61.54395   16.2334  2015-05-22 13:52:24     None
4            4  636092006  -61.52401  15.81954  2015-05-22 13:51:23     None
...        ...        ...        ...       ...                  ...      ...
617257  238722  256525000  -61.40679  15.36907  2015-05-21 21:34:59     None
617258  238723  311077100  -61.37539  15.27406  2015-05-21 21:34:55     None
617259  238724  377907247  -61.39461  15.30672  2015-05-21 21:34:46     None
617260  238725  253365000  -61.49001  16.14007  2015-05-21 21:34:46     None
617261  238726  329002300  -61.48073  15.44751  2015-05-21 21:34:45     None

[617262 rows x 6 columns]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap the geometries</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>vessel_points <span class="op">=</span> gpd.points_from_xy(vessels[<span class="st">'LON'</span>], vessels[<span class="st">'LAT'</span>])</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>vessel_gdf <span class="op">=</span> gpd.GeoDataFrame(vessels, geometry<span class="op">=</span>vessel_points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># project the dataset into an appropriate CRS</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>vessel_gdf <span class="op">=</span> vessel_gdf.set_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>vessel_gdf <span class="op">=</span> vessel_gdf.to_crs(epsg<span class="op">=</span>proj_area_crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>vessel_gdf.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Derived Projected CRS: EPSG:2002&gt;
Name: Dominica 1945 / British West Indies Grid
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Dominica - onshore.
- bounds: (-61.55, 15.14, -61.2, 15.69)
Coordinate Operation:
- name: British West Indies Grid
- method: Transverse Mercator
Datum: Dominica 1945
- Ellipsoid: Clarke 1880 (RGS)
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>vessel_gdf[<span class="st">'TIMESTAMP'</span>] <span class="op">=</span> pd.to_datetime(vessel_gdf[<span class="st">'TIMESTAMP'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>vessel_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  field_1       MMSI  ...           TIMESTAMP                        geometry
0       0  233092000  ... 2015-05-22 13:53:26  POINT (415373.315 1683307.035)
1       1  255803280  ... 2015-05-22 13:52:57  POINT (426434.345 1763918.193)
2       2  329002300  ... 2015-05-22 13:52:32  POINT (464555.392 1690588.725)
3       3  257674000  ... 2015-05-22 13:52:24  POINT (447770.634 1794068.620)
4       4  636092006  ... 2015-05-22 13:51:23  POINT (450006.361 1748297.844)

[5 rows x 6 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of all vessel points</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>vessel_gdf.plot(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-51-7.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of all vessel points</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>vessel_gdf.plot(ax<span class="op">=</span>base, markersize <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.plot(ax<span class="op">=</span>base, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-52-9.png" class="img-fluid" width="1440"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spatially subset AIS data to only include vessels within identified whale habitat</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat <span class="op">=</span> vessel_gdf.sjoin(speed_reduction_zone, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       field_1       MMSI  ...                        geometry index_right
2            2  329002300  ...  POINT (464555.392 1690588.725)           0
7            7  338143127  ...  POINT (463892.452 1694650.397)           0
13          13  329002300  ...  POINT (464555.389 1690589.831)           0
15          15  338143015  ...  POINT (463910.683 1694655.978)           0
16          16  338143127  ...  POINT (463697.964 1694341.275)           0
...        ...        ...  ...                             ...         ...
617252  238717  329002300  ...  POINT (453901.647 1709712.916)           0
617253  238718  338143015  ...  POINT (463915.972 1694683.643)           0
617255  238720  338143127  ...  POINT (463905.177 1694705.734)           0
617259  238724  377907247  ...  POINT (464023.288 1691613.624)           0
617261  238726  329002300  ...  POINT (454741.236 1707161.130)           0

[167411 rows x 7 columns]</code></pre>
</div>
</div>
</section>
<section id="calculate-distance-and-speed" class="level2">
<h2 class="anchored" data-anchor-id="calculate-distance-and-speed">Calculate distance and speed</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of only vessel points within speed reduction zone</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.plot(ax<span class="op">=</span>base, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat.plot(ax<span class="op">=</span>base, markersize <span class="op">=</span> <span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>base, crs<span class="op">=</span>dominica.crs.to_string())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort vessel dataframe by MMSI and time</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat <span class="op">=</span> vessels_in_whale_habitat.sort_values(by<span class="op">=</span>[<span class="st">'MMSI'</span>, <span class="st">'TIMESTAMP'</span>])</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       field_1       MMSI  ...                        geometry index_right
235025  235025  203106200  ...  POINT (462476.396 1680935.224)           0
235018  235018  203106200  ...  POINT (462283.995 1681393.698)           0
235000  235000  203106200  ...  POINT (461936.769 1682722.187)           0
234989  234989  203106200  ...  POINT (461798.818 1683708.377)           0
234984  234984  203106200  ...  POINT (461654.150 1683997.765)           0
...        ...        ...  ...                             ...         ...
259103  259103  983191049  ...  POINT (465250.372 1690066.434)           0
259094  259094  983191049  ...  POINT (465243.965 1690054.249)           0
258954  258954  983191049  ...  POINT (465226.597 1690121.667)           0
258930  258930  983191049  ...  POINT (465242.895 1690053.140)           0
258206  258206  983191049  ...  POINT (465272.964 1690049.908)           0

[167411 rows x 7 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a copy of the vessel dataframe and shift each observation down one row using `shift()`</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>vessels_shift <span class="op">=</span> vessels_in_whale_habitat.copy(deep<span class="op">=</span><span class="va">True</span>).shift(periods<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename shifted column names</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>vessels_shift <span class="op">=</span> vessels_shift.rename(columns<span class="op">=</span>{<span class="st">"field_1"</span>: <span class="st">"field_1_shift"</span>, <span class="st">"MMSI"</span>: <span class="st">"MMSI_shift"</span>, <span class="st">"LON"</span>: <span class="st">"LON_shift"</span>, <span class="st">"LAT"</span>: <span class="st">"LAT_shift"</span>, <span class="st">"TIMESTAMP"</span>: <span class="st">"TIMESTAMP_shift"</span>, <span class="st">"geometry"</span>: <span class="st">"geometry_shift"</span>, <span class="st">"index_right"</span>: <span class="st">"index_right_shift"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join original dataframe with the shifted copy using `join()`</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>vessels_shift_join <span class="op">=</span> vessels_in_whale_habitat.join(vessels_shift).sort_values(by<span class="op">=</span>[<span class="st">'MMSI'</span>, <span class="st">'TIMESTAMP'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop all rows in the joined dataframe in which the MMSI of the left is not the same as the one on the right</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>vessels_keep <span class="op">=</span> vessels_shift_join.drop(vessels_shift_join[vessels_shift_join[<span class="st">'MMSI'</span>] <span class="op">!=</span> vessels_shift_join[<span class="st">'MMSI_shift'</span>]].index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the geometry column</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>vessels_keep <span class="op">=</span> vessels_keep.set_geometry(<span class="st">"geometry"</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>vessels_keep2 <span class="op">=</span> vessels_keep.set_geometry(<span class="st">"geometry_shift"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance between each observation</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'distance_m'</span>] <span class="op">=</span> vessels_keep.distance(vessels_keep2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate time difference between each observation to the next</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'time'</span>] <span class="op">=</span> vessels_keep[<span class="st">'TIMESTAMP'</span>] <span class="op">-</span> vessels_keep[<span class="st">'TIMESTAMP_shift'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate speed</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>meters_per_nm <span class="op">=</span> <span class="dv">1852</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'speed_m_per_sec'</span>] <span class="op">=</span> vessels_keep[<span class="st">'distance_m'</span>] <span class="op">/</span> vessels_keep[<span class="st">'time'</span>].dt.total_seconds()</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'speed_knots'</span>] <span class="op">=</span> vessels_keep[<span class="st">'speed_m_per_sec'</span>] <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">/</span> meters_per_nm</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'time_10knots_minutes'</span>] <span class="op">=</span> (vessels_keep[<span class="st">'distance_m'</span>] <span class="op">*</span> <span class="dv">60</span> ) <span class="op">/</span> ( meters_per_nm <span class="op">*</span> <span class="dv">10</span> )</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'time_dif_minutes'</span>] <span class="op">=</span> vessels_keep[<span class="st">'time_10knots_minutes'</span>] <span class="op">-</span> (vessels_keep[<span class="st">'time'</span>].dt.total_seconds() <span class="op">/</span> <span class="dv">60</span> )</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>vessels_keep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       field_1       MMSI  ... time_10knots_minutes time_dif_minutes
235018  235018  203106200  ...             1.610828        -0.889172
235000  235000  203106200  ...             4.448540        -3.034793
234989  234989  203106200  ...             3.226109        -1.773891
234984  234984  203106200  ...             1.048164        -1.468503
234972  234972  203106200  ...             1.394116        -3.589217
...        ...        ...  ...                  ...              ...
259103  259103  983191049  ...             0.043139        -5.940194
259094  259094  983191049  ...             0.044599        -4.355401
258954  258954  983191049  ...             0.225548       -55.824452
258930  258930  983191049  ...             0.228202       -11.471798
258206  258206  983191049  ...             0.097976      -248.585358

[166255 rows x 20 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>vessels_keep <span class="op">=</span> vessels_keep.sort_values(by<span class="op">=</span>[<span class="st">'speed_knots'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the vessels that would be affected by the speed reduction zone</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>vessels_going_too_fast <span class="op">=</span> vessels_keep.drop(vessels_keep[vessels_keep[<span class="st">'time_dif_minutes'</span>] <span class="op">&lt;</span> <span class="dv">0</span>].index)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>vessels_going_too_fast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       field_1       MMSI  ... time_10knots_minutes time_dif_minutes
585844  207309  341387000  ...             0.209101         0.209101
67091    67091  227528210  ...             7.979167         6.245834
66925    66925  228008600  ...            13.481637        10.498303
499754  121219  329002300  ...             8.728323         6.711656
546817  168282  329002300  ...            12.866650         9.849984
...        ...        ...  ...                  ...              ...
616429  237894  636091437  ...             0.000000         0.000000
616427  237892  636091437  ...             0.000000         0.000000
616422  237887  636091437  ...             0.000000         0.000000
616419  237884  636091437  ...             0.000000         0.000000
616408  237873  636091437  ...             0.000000         0.000000

[21410 rows x 20 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>shipping_impact_minutes <span class="op">=</span> vessels_going_too_fast[<span class="st">'time_dif_minutes'</span>].<span class="bu">sum</span>()</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>shipping_impact_days <span class="op">=</span> <span class="bu">round</span>(shipping_impact_minutes <span class="op">/</span> ( <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span>), <span class="dv">2</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>shipping_impact_days</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>27.88</code></pre>
</div>
</div>
<p><strong>A 10-knot reduced speed zone in the identified whale habitat will increase travel time by approximately 27.88 days.</strong></p>



<!-- -->

</section>
</section>
<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rivers2022,
  author = {Marie Rivers},
  title = {Protecting {Whales} from {Ships}},
  date = {2022-04-03},
  url = {https://marierivers.github.io/posts/2022-04-03-protecting-whales-from-ships/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rivers2022" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Marie Rivers. 2022. <span>Protecting Whales from Ships.</span> April
3, 2022. <a href="https://marierivers.github.io/posts/2022-04-03-protecting-whales-from-ships/">https://marierivers.github.io/posts/2022-04-03-protecting-whales-from-ships/</a>.
</div></div></section></div></main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb101" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Protecting Whales from Ships"</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "A spatial analysis using Python and GeoPandas"</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Marie Rivers</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://marierivers.github.io/</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2022-04-03</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Python, geopandas, statial analysis]</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> </span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://marierivers.github.io/posts/2022-04-03-protecting-whales-from-ships/ </span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co">#image: </span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="an">toc-title:</span><span class="co"> Contents</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="an">toc-location:</span><span class="co"> left</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 2</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> </span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a><span class="co">  source: true</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a><span class="co">  toggle: true</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="co">  caption: view code</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-bg:</span><span class="co"> true</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-border-left:</span><span class="co"> "#31BAE9"</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>This analysis identifies a speed reduction zone off the island of Dominica for the purpose of reducing the occurrence of ships striking whales and quantifies the impact of reduced travel speeds on marine traffic.</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Setup</span></span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapely</span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb101-44"><a href="#cb101-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygeos</span>
<span id="cb101-45"><a href="#cb101-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-46"><a href="#cb101-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-47"><a href="#cb101-47" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dominica outline</span></span>
<span id="cb101-48"><a href="#cb101-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-51"><a href="#cb101-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-52"><a href="#cb101-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Define path to folder</span></span>
<span id="cb101-53"><a href="#cb101-53" aria-hidden="true" tabindex="-1"></a>input_folder <span class="op">=</span> <span class="vs">r"data/dominica"</span></span>
<span id="cb101-54"><a href="#cb101-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-55"><a href="#cb101-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Join folder path and filename </span></span>
<span id="cb101-56"><a href="#cb101-56" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> os.path.join(input_folder, <span class="st">"dma_admn_adm0_py_s1_dominode_v2.shp"</span>)</span>
<span id="cb101-57"><a href="#cb101-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-58"><a href="#cb101-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the full file path</span></span>
<span id="cb101-59"><a href="#cb101-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp)</span>
<span id="cb101-60"><a href="#cb101-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-61"><a href="#cb101-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-62"><a href="#cb101-62" aria-hidden="true" tabindex="-1"></a><span class="in">    data/dominica/dma_admn_adm0_py_s1_dominode_v2.shp</span></span>
<span id="cb101-63"><a href="#cb101-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-66"><a href="#cb101-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-67"><a href="#cb101-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Read file using gpd.read_file()</span></span>
<span id="cb101-68"><a href="#cb101-68" aria-hidden="true" tabindex="-1"></a>dominica <span class="op">=</span> gpd.read_file(fp)</span>
<span id="cb101-69"><a href="#cb101-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-70"><a href="#cb101-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-73"><a href="#cb101-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-74"><a href="#cb101-74" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(dominica)</span>
<span id="cb101-75"><a href="#cb101-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-76"><a href="#cb101-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-79"><a href="#cb101-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-80"><a href="#cb101-80" aria-hidden="true" tabindex="-1"></a>dominica.head()</span>
<span id="cb101-81"><a href="#cb101-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-82"><a href="#cb101-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-85"><a href="#cb101-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-86"><a href="#cb101-86" aria-hidden="true" tabindex="-1"></a>dominica.crs</span>
<span id="cb101-87"><a href="#cb101-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-88"><a href="#cb101-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-91"><a href="#cb101-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-92"><a href="#cb101-92" aria-hidden="true" tabindex="-1"></a><span class="co"># change the projection to Dominica 1945 / British West Indies Grid (metric units)</span></span>
<span id="cb101-93"><a href="#cb101-93" aria-hidden="true" tabindex="-1"></a>proj_area_crs <span class="op">=</span> <span class="dv">2002</span> <span class="co"># project area coordinate system EPSG code. Projected CRS for Dominica is 2002</span></span>
<span id="cb101-94"><a href="#cb101-94" aria-hidden="true" tabindex="-1"></a>dominica <span class="op">=</span> dominica.to_crs(epsg<span class="op">=</span>proj_area_crs)</span>
<span id="cb101-95"><a href="#cb101-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-96"><a href="#cb101-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-99"><a href="#cb101-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-100"><a href="#cb101-100" aria-hidden="true" tabindex="-1"></a>dominica.crs</span>
<span id="cb101-101"><a href="#cb101-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-102"><a href="#cb101-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-103"><a href="#cb101-103" aria-hidden="true" tabindex="-1"></a><span class="fu"># Plot the Dominica outline</span></span>
<span id="cb101-104"><a href="#cb101-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-107"><a href="#cb101-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-108"><a href="#cb101-108" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> dominica.plot(color<span class="op">=</span><span class="st">"none"</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">9</span>))</span>
<span id="cb101-109"><a href="#cb101-109" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax, crs<span class="op">=</span>dominica.crs.to_string())</span>
<span id="cb101-110"><a href="#cb101-110" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb101-111"><a href="#cb101-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-112"><a href="#cb101-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-113"><a href="#cb101-113" aria-hidden="true" tabindex="-1"></a><span class="fu"># Whale sighting data</span></span>
<span id="cb101-114"><a href="#cb101-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-115"><a href="#cb101-115" aria-hidden="true" tabindex="-1"></a>Whale habitat was approximated using data from approximately 5,000 whale sightings between 2008 and 2015.</span>
<span id="cb101-116"><a href="#cb101-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-119"><a href="#cb101-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-120"><a href="#cb101-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Define path to folder</span></span>
<span id="cb101-121"><a href="#cb101-121" aria-hidden="true" tabindex="-1"></a>input_folder2 <span class="op">=</span> <span class="vs">r"data"</span></span>
<span id="cb101-122"><a href="#cb101-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-123"><a href="#cb101-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Join folder path and filename </span></span>
<span id="cb101-124"><a href="#cb101-124" aria-hidden="true" tabindex="-1"></a>fp2 <span class="op">=</span> os.path.join(input_folder2, <span class="st">"sightings2005_2018.csv"</span>)</span>
<span id="cb101-125"><a href="#cb101-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-126"><a href="#cb101-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the full file path</span></span>
<span id="cb101-127"><a href="#cb101-127" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp2)</span>
<span id="cb101-128"><a href="#cb101-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-129"><a href="#cb101-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-132"><a href="#cb101-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-133"><a href="#cb101-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Read file using gpd.read_file()</span></span>
<span id="cb101-134"><a href="#cb101-134" aria-hidden="true" tabindex="-1"></a>whales <span class="op">=</span> gpd.read_file(fp2)</span>
<span id="cb101-135"><a href="#cb101-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-136"><a href="#cb101-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-139"><a href="#cb101-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-140"><a href="#cb101-140" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(whales)</span>
<span id="cb101-141"><a href="#cb101-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-142"><a href="#cb101-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-145"><a href="#cb101-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-146"><a href="#cb101-146" aria-hidden="true" tabindex="-1"></a>whales.head()</span>
<span id="cb101-147"><a href="#cb101-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-148"><a href="#cb101-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-151"><a href="#cb101-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-152"><a href="#cb101-152" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap the geometries</span></span>
<span id="cb101-153"><a href="#cb101-153" aria-hidden="true" tabindex="-1"></a>whale_points <span class="op">=</span> gpd.points_from_xy(whales[<span class="st">'Long'</span>], whales[<span class="st">'Lat'</span>])</span>
<span id="cb101-154"><a href="#cb101-154" aria-hidden="true" tabindex="-1"></a>whale_gdf <span class="op">=</span> gpd.GeoDataFrame(whales, geometry<span class="op">=</span>whale_points)</span>
<span id="cb101-155"><a href="#cb101-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-156"><a href="#cb101-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-159"><a href="#cb101-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-160"><a href="#cb101-160" aria-hidden="true" tabindex="-1"></a>whale_gdf.head()</span>
<span id="cb101-161"><a href="#cb101-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-162"><a href="#cb101-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-165"><a href="#cb101-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-166"><a href="#cb101-166" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(whale_gdf)</span>
<span id="cb101-167"><a href="#cb101-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-168"><a href="#cb101-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-171"><a href="#cb101-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-172"><a href="#cb101-172" aria-hidden="true" tabindex="-1"></a><span class="co"># project the dataset into an appropriate CRS</span></span>
<span id="cb101-173"><a href="#cb101-173" aria-hidden="true" tabindex="-1"></a>whale_gdf <span class="op">=</span> whale_gdf.set_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb101-174"><a href="#cb101-174" aria-hidden="true" tabindex="-1"></a>whale_gdf <span class="op">=</span> whale_gdf.to_crs(epsg<span class="op">=</span>proj_area_crs)</span>
<span id="cb101-175"><a href="#cb101-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-176"><a href="#cb101-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-179"><a href="#cb101-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-180"><a href="#cb101-180" aria-hidden="true" tabindex="-1"></a>whale_gdf.crs</span>
<span id="cb101-181"><a href="#cb101-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-182"><a href="#cb101-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-185"><a href="#cb101-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-186"><a href="#cb101-186" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb101-187"><a href="#cb101-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-188"><a href="#cb101-188" aria-hidden="true" tabindex="-1"></a>whale_gdf.plot(ax<span class="op">=</span>ax)</span>
<span id="cb101-189"><a href="#cb101-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-190"><a href="#cb101-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-191"><a href="#cb101-191" aria-hidden="true" tabindex="-1"></a><span class="fu"># Create grid</span></span>
<span id="cb101-192"><a href="#cb101-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-195"><a href="#cb101-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-196"><a href="#cb101-196" aria-hidden="true" tabindex="-1"></a>xmin, ymin, xmax, ymax <span class="op">=</span> whale_gdf.total_bounds</span>
<span id="cb101-197"><a href="#cb101-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-198"><a href="#cb101-198" aria-hidden="true" tabindex="-1"></a>cell_size <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb101-199"><a href="#cb101-199" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb101-200"><a href="#cb101-200" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb101-201"><a href="#cb101-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-202"><a href="#cb101-202" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> <span class="bu">list</span>(np.arange(xmin, xmax <span class="op">+</span> width, width)) <span class="co"># return evenly spaced values starting at xmin, stopping (but not including) at xmax+width, by a step of width</span></span>
<span id="cb101-203"><a href="#cb101-203" aria-hidden="true" tabindex="-1"></a>ys <span class="op">=</span> <span class="bu">list</span>(np.arange(ymin, ymax <span class="op">+</span> length, length))</span>
<span id="cb101-204"><a href="#cb101-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-205"><a href="#cb101-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-208"><a href="#cb101-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-209"><a href="#cb101-209" aria-hidden="true" tabindex="-1"></a>xmin, ymin, xmax, ymax</span>
<span id="cb101-210"><a href="#cb101-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-211"><a href="#cb101-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-214"><a href="#cb101-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-215"><a href="#cb101-215" aria-hidden="true" tabindex="-1"></a><span class="co"># function to convert corner points into a cell polygon</span></span>
<span id="cb101-216"><a href="#cb101-216" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_cell(x, y, cell_size):</span>
<span id="cb101-217"><a href="#cb101-217" aria-hidden="true" tabindex="-1"></a>    ring <span class="op">=</span> [</span>
<span id="cb101-218"><a href="#cb101-218" aria-hidden="true" tabindex="-1"></a>        (x, y),</span>
<span id="cb101-219"><a href="#cb101-219" aria-hidden="true" tabindex="-1"></a>        (x <span class="op">+</span> cell_size, y),</span>
<span id="cb101-220"><a href="#cb101-220" aria-hidden="true" tabindex="-1"></a>        (x <span class="op">+</span> cell_size, y <span class="op">+</span> cell_size),</span>
<span id="cb101-221"><a href="#cb101-221" aria-hidden="true" tabindex="-1"></a>        (x, y <span class="op">+</span> cell_size)</span>
<span id="cb101-222"><a href="#cb101-222" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb101-223"><a href="#cb101-223" aria-hidden="true" tabindex="-1"></a>    cell <span class="op">=</span> shapely.geometry.Polygon(ring)</span>
<span id="cb101-224"><a href="#cb101-224" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cell</span>
<span id="cb101-225"><a href="#cb101-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-226"><a href="#cb101-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-229"><a href="#cb101-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-230"><a href="#cb101-230" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate over each combination of x and y coordinates in two nested for loops</span></span>
<span id="cb101-231"><a href="#cb101-231" aria-hidden="true" tabindex="-1"></a>cells <span class="op">=</span> []</span>
<span id="cb101-232"><a href="#cb101-232" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> xs:</span>
<span id="cb101-233"><a href="#cb101-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> ys:</span>
<span id="cb101-234"><a href="#cb101-234" aria-hidden="true" tabindex="-1"></a>        cell <span class="op">=</span> make_cell(x, y, cell_size)</span>
<span id="cb101-235"><a href="#cb101-235" aria-hidden="true" tabindex="-1"></a>        cells.append(cell)</span>
<span id="cb101-236"><a href="#cb101-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-237"><a href="#cb101-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-240"><a href="#cb101-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-241"><a href="#cb101-241" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> gpd.GeoDataFrame({<span class="st">'geometry'</span>:cells}, crs<span class="op">=</span>proj_area_crs)</span>
<span id="cb101-242"><a href="#cb101-242" aria-hidden="true" tabindex="-1"></a><span class="co">#grid.to_file("grid.shp")</span></span>
<span id="cb101-243"><a href="#cb101-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-244"><a href="#cb101-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-247"><a href="#cb101-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-248"><a href="#cb101-248" aria-hidden="true" tabindex="-1"></a>grid.head()</span>
<span id="cb101-249"><a href="#cb101-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-250"><a href="#cb101-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-253"><a href="#cb101-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-254"><a href="#cb101-254" aria-hidden="true" tabindex="-1"></a>grid.crs</span>
<span id="cb101-255"><a href="#cb101-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-256"><a href="#cb101-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-259"><a href="#cb101-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-260"><a href="#cb101-260" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), dpi<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb101-261"><a href="#cb101-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-262"><a href="#cb101-262" aria-hidden="true" tabindex="-1"></a>grid.boundary.plot(ax<span class="op">=</span>ax, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb101-263"><a href="#cb101-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-264"><a href="#cb101-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-267"><a href="#cb101-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-268"><a href="#cb101-268" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb101-269"><a href="#cb101-269" aria-hidden="true" tabindex="-1"></a>whale_gdf.plot(ax<span class="op">=</span>base, facecolor<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb101-270"><a href="#cb101-270" aria-hidden="true" tabindex="-1"></a>grid.boundary.plot(ax<span class="op">=</span>base, linewidth <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb101-271"><a href="#cb101-271" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>base, crs<span class="op">=</span>dominica.crs.to_string())</span>
<span id="cb101-272"><a href="#cb101-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-273"><a href="#cb101-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-274"><a href="#cb101-274" aria-hidden="true" tabindex="-1"></a><span class="fu"># Extract whale habitat</span></span>
<span id="cb101-275"><a href="#cb101-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-278"><a href="#cb101-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-279"><a href="#cb101-279" aria-hidden="true" tabindex="-1"></a><span class="co"># spatially join the grid with whale sighting data to count the number of sightings in each cell</span></span>
<span id="cb101-280"><a href="#cb101-280" aria-hidden="true" tabindex="-1"></a><span class="co"># use an inner join since we're not interested in grid cells without any sightings</span></span>
<span id="cb101-281"><a href="#cb101-281" aria-hidden="true" tabindex="-1"></a>whale_grid <span class="op">=</span> grid.sjoin(whale_gdf, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb101-282"><a href="#cb101-282" aria-hidden="true" tabindex="-1"></a>whale_grid</span>
<span id="cb101-283"><a href="#cb101-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-284"><a href="#cb101-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-287"><a href="#cb101-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-288"><a href="#cb101-288" aria-hidden="true" tabindex="-1"></a>whale_grid.boundary.plot(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb101-289"><a href="#cb101-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-290"><a href="#cb101-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-293"><a href="#cb101-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-294"><a href="#cb101-294" aria-hidden="true" tabindex="-1"></a>whale_grid.crs</span>
<span id="cb101-295"><a href="#cb101-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-296"><a href="#cb101-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-299"><a href="#cb101-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-300"><a href="#cb101-300" aria-hidden="true" tabindex="-1"></a>grid[<span class="st">'count'</span>] <span class="op">=</span> whale_grid.groupby(whale_grid.index).count()[<span class="st">'index_right'</span>]</span>
<span id="cb101-301"><a href="#cb101-301" aria-hidden="true" tabindex="-1"></a>grid</span>
<span id="cb101-302"><a href="#cb101-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-303"><a href="#cb101-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-306"><a href="#cb101-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-307"><a href="#cb101-307" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the grid dataframe to cells that have more than 20 sightings</span></span>
<span id="cb101-308"><a href="#cb101-308" aria-hidden="true" tabindex="-1"></a>whale_mask <span class="op">=</span> (grid[<span class="st">'count'</span>] <span class="op">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb101-309"><a href="#cb101-309" aria-hidden="true" tabindex="-1"></a>whale_mask</span>
<span id="cb101-310"><a href="#cb101-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-311"><a href="#cb101-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-314"><a href="#cb101-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-315"><a href="#cb101-315" aria-hidden="true" tabindex="-1"></a>whale_habitat <span class="op">=</span> grid[whale_mask]</span>
<span id="cb101-316"><a href="#cb101-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-317"><a href="#cb101-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-320"><a href="#cb101-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-321"><a href="#cb101-321" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone <span class="op">=</span> whale_habitat.unary_union.convex_hull</span>
<span id="cb101-322"><a href="#cb101-322" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone</span>
<span id="cb101-323"><a href="#cb101-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-324"><a href="#cb101-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-327"><a href="#cb101-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-328"><a href="#cb101-328" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(speed_reduction_zone)</span>
<span id="cb101-329"><a href="#cb101-329" aria-hidden="true" tabindex="-1"></a><span class="co"># need to create a new GeoDataFrame with the speed_reduction_zone as a single feature</span></span>
<span id="cb101-330"><a href="#cb101-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-331"><a href="#cb101-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-334"><a href="#cb101-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-335"><a href="#cb101-335" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone <span class="op">=</span> gpd.GeoDataFrame(index<span class="op">=</span>[<span class="dv">0</span>], crs<span class="op">=</span><span class="st">'epsg:2002'</span>, geometry<span class="op">=</span>[speed_reduction_zone])</span>
<span id="cb101-336"><a href="#cb101-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-337"><a href="#cb101-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-340"><a href="#cb101-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-341"><a href="#cb101-341" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.crs</span>
<span id="cb101-342"><a href="#cb101-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-343"><a href="#cb101-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-346"><a href="#cb101-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-347"><a href="#cb101-347" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(speed_reduction_zone)</span>
<span id="cb101-348"><a href="#cb101-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-349"><a href="#cb101-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-352"><a href="#cb101-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-353"><a href="#cb101-353" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb101-354"><a href="#cb101-354" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.plot(ax<span class="op">=</span>base, facecolor<span class="op">=</span><span class="st">'lightgray'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb101-355"><a href="#cb101-355" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>base, crs<span class="op">=</span>dominica.crs.to_string())</span>
<span id="cb101-356"><a href="#cb101-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-357"><a href="#cb101-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-358"><a href="#cb101-358" aria-hidden="true" tabindex="-1"></a><span class="fu"># Vessel data</span></span>
<span id="cb101-359"><a href="#cb101-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-360"><a href="#cb101-360" aria-hidden="true" tabindex="-1"></a>Vessel data was obtained from Automatic Identification System (AIS) tranceivers from 2015.</span>
<span id="cb101-361"><a href="#cb101-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-362"><a href="#cb101-362" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load data</span></span>
<span id="cb101-363"><a href="#cb101-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-366"><a href="#cb101-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-367"><a href="#cb101-367" aria-hidden="true" tabindex="-1"></a><span class="co"># Join folder path and filename </span></span>
<span id="cb101-368"><a href="#cb101-368" aria-hidden="true" tabindex="-1"></a>fp3 <span class="op">=</span> os.path.join(input_folder2, <span class="st">"station1249.csv"</span>)</span>
<span id="cb101-369"><a href="#cb101-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-370"><a href="#cb101-370" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the full file path</span></span>
<span id="cb101-371"><a href="#cb101-371" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fp3)</span>
<span id="cb101-372"><a href="#cb101-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-373"><a href="#cb101-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-376"><a href="#cb101-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-377"><a href="#cb101-377" aria-hidden="true" tabindex="-1"></a><span class="co"># Read file using gpd.read_file()</span></span>
<span id="cb101-378"><a href="#cb101-378" aria-hidden="true" tabindex="-1"></a>vessels <span class="op">=</span> gpd.read_file(fp3)</span>
<span id="cb101-379"><a href="#cb101-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-380"><a href="#cb101-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-383"><a href="#cb101-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-384"><a href="#cb101-384" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(vessels)</span>
<span id="cb101-385"><a href="#cb101-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-386"><a href="#cb101-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-389"><a href="#cb101-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-390"><a href="#cb101-390" aria-hidden="true" tabindex="-1"></a>vessels.head</span>
<span id="cb101-391"><a href="#cb101-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-392"><a href="#cb101-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-395"><a href="#cb101-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-396"><a href="#cb101-396" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap the geometries</span></span>
<span id="cb101-397"><a href="#cb101-397" aria-hidden="true" tabindex="-1"></a>vessel_points <span class="op">=</span> gpd.points_from_xy(vessels[<span class="st">'LON'</span>], vessels[<span class="st">'LAT'</span>])</span>
<span id="cb101-398"><a href="#cb101-398" aria-hidden="true" tabindex="-1"></a>vessel_gdf <span class="op">=</span> gpd.GeoDataFrame(vessels, geometry<span class="op">=</span>vessel_points)</span>
<span id="cb101-399"><a href="#cb101-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-400"><a href="#cb101-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-403"><a href="#cb101-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-404"><a href="#cb101-404" aria-hidden="true" tabindex="-1"></a><span class="co"># project the dataset into an appropriate CRS</span></span>
<span id="cb101-405"><a href="#cb101-405" aria-hidden="true" tabindex="-1"></a>vessel_gdf <span class="op">=</span> vessel_gdf.set_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb101-406"><a href="#cb101-406" aria-hidden="true" tabindex="-1"></a>vessel_gdf <span class="op">=</span> vessel_gdf.to_crs(epsg<span class="op">=</span>proj_area_crs)</span>
<span id="cb101-407"><a href="#cb101-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-408"><a href="#cb101-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-411"><a href="#cb101-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-412"><a href="#cb101-412" aria-hidden="true" tabindex="-1"></a>vessel_gdf.crs</span>
<span id="cb101-413"><a href="#cb101-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-414"><a href="#cb101-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-417"><a href="#cb101-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-418"><a href="#cb101-418" aria-hidden="true" tabindex="-1"></a>vessel_gdf[<span class="st">'TIMESTAMP'</span>] <span class="op">=</span> pd.to_datetime(vessel_gdf[<span class="st">'TIMESTAMP'</span>])</span>
<span id="cb101-419"><a href="#cb101-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-420"><a href="#cb101-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-423"><a href="#cb101-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-424"><a href="#cb101-424" aria-hidden="true" tabindex="-1"></a>vessel_gdf.head()</span>
<span id="cb101-425"><a href="#cb101-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-426"><a href="#cb101-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-429"><a href="#cb101-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-430"><a href="#cb101-430" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of all vessel points</span></span>
<span id="cb101-431"><a href="#cb101-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-432"><a href="#cb101-432" aria-hidden="true" tabindex="-1"></a>vessel_gdf.plot(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">10</span>))</span>
<span id="cb101-433"><a href="#cb101-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-434"><a href="#cb101-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-437"><a href="#cb101-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-438"><a href="#cb101-438" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of all vessel points</span></span>
<span id="cb101-439"><a href="#cb101-439" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb101-440"><a href="#cb101-440" aria-hidden="true" tabindex="-1"></a>vessel_gdf.plot(ax<span class="op">=</span>base, markersize <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb101-441"><a href="#cb101-441" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.plot(ax<span class="op">=</span>base, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb101-442"><a href="#cb101-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-443"><a href="#cb101-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-446"><a href="#cb101-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-447"><a href="#cb101-447" aria-hidden="true" tabindex="-1"></a><span class="co"># spatially subset AIS data to only include vessels within identified whale habitat</span></span>
<span id="cb101-448"><a href="#cb101-448" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat <span class="op">=</span> vessel_gdf.sjoin(speed_reduction_zone, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb101-449"><a href="#cb101-449" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat</span>
<span id="cb101-450"><a href="#cb101-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-451"><a href="#cb101-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-452"><a href="#cb101-452" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate distance and speed</span></span>
<span id="cb101-453"><a href="#cb101-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-456"><a href="#cb101-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-457"><a href="#cb101-457" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of only vessel points within speed reduction zone</span></span>
<span id="cb101-458"><a href="#cb101-458" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> dominica.plot(facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb101-459"><a href="#cb101-459" aria-hidden="true" tabindex="-1"></a>speed_reduction_zone.plot(ax<span class="op">=</span>base, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb101-460"><a href="#cb101-460" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat.plot(ax<span class="op">=</span>base, markersize <span class="op">=</span> <span class="fl">0.5</span>, facecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb101-461"><a href="#cb101-461" aria-hidden="true" tabindex="-1"></a>ctx.add_basemap(ax<span class="op">=</span>base, crs<span class="op">=</span>dominica.crs.to_string())</span>
<span id="cb101-462"><a href="#cb101-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-463"><a href="#cb101-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-466"><a href="#cb101-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-467"><a href="#cb101-467" aria-hidden="true" tabindex="-1"></a><span class="co"># sort vessel dataframe by MMSI and time</span></span>
<span id="cb101-468"><a href="#cb101-468" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat <span class="op">=</span> vessels_in_whale_habitat.sort_values(by<span class="op">=</span>[<span class="st">'MMSI'</span>, <span class="st">'TIMESTAMP'</span>])</span>
<span id="cb101-469"><a href="#cb101-469" aria-hidden="true" tabindex="-1"></a>vessels_in_whale_habitat</span>
<span id="cb101-470"><a href="#cb101-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-471"><a href="#cb101-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-474"><a href="#cb101-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-475"><a href="#cb101-475" aria-hidden="true" tabindex="-1"></a><span class="co"># create a copy of the vessel dataframe and shift each observation down one row using `shift()`</span></span>
<span id="cb101-476"><a href="#cb101-476" aria-hidden="true" tabindex="-1"></a>vessels_shift <span class="op">=</span> vessels_in_whale_habitat.copy(deep<span class="op">=</span><span class="va">True</span>).shift(periods<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb101-477"><a href="#cb101-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-478"><a href="#cb101-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-481"><a href="#cb101-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-482"><a href="#cb101-482" aria-hidden="true" tabindex="-1"></a><span class="co"># rename shifted column names</span></span>
<span id="cb101-483"><a href="#cb101-483" aria-hidden="true" tabindex="-1"></a>vessels_shift <span class="op">=</span> vessels_shift.rename(columns<span class="op">=</span>{<span class="st">"field_1"</span>: <span class="st">"field_1_shift"</span>, <span class="st">"MMSI"</span>: <span class="st">"MMSI_shift"</span>, <span class="st">"LON"</span>: <span class="st">"LON_shift"</span>, <span class="st">"LAT"</span>: <span class="st">"LAT_shift"</span>, <span class="st">"TIMESTAMP"</span>: <span class="st">"TIMESTAMP_shift"</span>, <span class="st">"geometry"</span>: <span class="st">"geometry_shift"</span>, <span class="st">"index_right"</span>: <span class="st">"index_right_shift"</span>})</span>
<span id="cb101-484"><a href="#cb101-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-485"><a href="#cb101-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-488"><a href="#cb101-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-489"><a href="#cb101-489" aria-hidden="true" tabindex="-1"></a><span class="co"># join original dataframe with the shifted copy using `join()`</span></span>
<span id="cb101-490"><a href="#cb101-490" aria-hidden="true" tabindex="-1"></a>vessels_shift_join <span class="op">=</span> vessels_in_whale_habitat.join(vessels_shift).sort_values(by<span class="op">=</span>[<span class="st">'MMSI'</span>, <span class="st">'TIMESTAMP'</span>])</span>
<span id="cb101-491"><a href="#cb101-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-492"><a href="#cb101-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-495"><a href="#cb101-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-496"><a href="#cb101-496" aria-hidden="true" tabindex="-1"></a><span class="co"># drop all rows in the joined dataframe in which the MMSI of the left is not the same as the one on the right</span></span>
<span id="cb101-497"><a href="#cb101-497" aria-hidden="true" tabindex="-1"></a>vessels_keep <span class="op">=</span> vessels_shift_join.drop(vessels_shift_join[vessels_shift_join[<span class="st">'MMSI'</span>] <span class="op">!=</span> vessels_shift_join[<span class="st">'MMSI_shift'</span>]].index)</span>
<span id="cb101-498"><a href="#cb101-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-499"><a href="#cb101-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-502"><a href="#cb101-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-503"><a href="#cb101-503" aria-hidden="true" tabindex="-1"></a><span class="co"># set the geometry column</span></span>
<span id="cb101-504"><a href="#cb101-504" aria-hidden="true" tabindex="-1"></a>vessels_keep <span class="op">=</span> vessels_keep.set_geometry(<span class="st">"geometry"</span>)</span>
<span id="cb101-505"><a href="#cb101-505" aria-hidden="true" tabindex="-1"></a>vessels_keep2 <span class="op">=</span> vessels_keep.set_geometry(<span class="st">"geometry_shift"</span>)</span>
<span id="cb101-506"><a href="#cb101-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-507"><a href="#cb101-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-510"><a href="#cb101-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-511"><a href="#cb101-511" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance between each observation</span></span>
<span id="cb101-512"><a href="#cb101-512" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'distance_m'</span>] <span class="op">=</span> vessels_keep.distance(vessels_keep2)</span>
<span id="cb101-513"><a href="#cb101-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-514"><a href="#cb101-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-517"><a href="#cb101-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-518"><a href="#cb101-518" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate time difference between each observation to the next</span></span>
<span id="cb101-519"><a href="#cb101-519" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'time'</span>] <span class="op">=</span> vessels_keep[<span class="st">'TIMESTAMP'</span>] <span class="op">-</span> vessels_keep[<span class="st">'TIMESTAMP_shift'</span>]</span>
<span id="cb101-520"><a href="#cb101-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-521"><a href="#cb101-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-524"><a href="#cb101-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-525"><a href="#cb101-525" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate speed</span></span>
<span id="cb101-526"><a href="#cb101-526" aria-hidden="true" tabindex="-1"></a>meters_per_nm <span class="op">=</span> <span class="dv">1852</span></span>
<span id="cb101-527"><a href="#cb101-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-528"><a href="#cb101-528" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'speed_m_per_sec'</span>] <span class="op">=</span> vessels_keep[<span class="st">'distance_m'</span>] <span class="op">/</span> vessels_keep[<span class="st">'time'</span>].dt.total_seconds()</span>
<span id="cb101-529"><a href="#cb101-529" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'speed_knots'</span>] <span class="op">=</span> vessels_keep[<span class="st">'speed_m_per_sec'</span>] <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">/</span> meters_per_nm</span>
<span id="cb101-530"><a href="#cb101-530" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'time_10knots_minutes'</span>] <span class="op">=</span> (vessels_keep[<span class="st">'distance_m'</span>] <span class="op">*</span> <span class="dv">60</span> ) <span class="op">/</span> ( meters_per_nm <span class="op">*</span> <span class="dv">10</span> )</span>
<span id="cb101-531"><a href="#cb101-531" aria-hidden="true" tabindex="-1"></a>vessels_keep[<span class="st">'time_dif_minutes'</span>] <span class="op">=</span> vessels_keep[<span class="st">'time_10knots_minutes'</span>] <span class="op">-</span> (vessels_keep[<span class="st">'time'</span>].dt.total_seconds() <span class="op">/</span> <span class="dv">60</span> )</span>
<span id="cb101-532"><a href="#cb101-532" aria-hidden="true" tabindex="-1"></a>vessels_keep</span>
<span id="cb101-533"><a href="#cb101-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-534"><a href="#cb101-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-537"><a href="#cb101-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-538"><a href="#cb101-538" aria-hidden="true" tabindex="-1"></a>vessels_keep <span class="op">=</span> vessels_keep.sort_values(by<span class="op">=</span>[<span class="st">'speed_knots'</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb101-539"><a href="#cb101-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-540"><a href="#cb101-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-543"><a href="#cb101-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-544"><a href="#cb101-544" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the vessels that would be affected by the speed reduction zone</span></span>
<span id="cb101-545"><a href="#cb101-545" aria-hidden="true" tabindex="-1"></a>vessels_going_too_fast <span class="op">=</span> vessels_keep.drop(vessels_keep[vessels_keep[<span class="st">'time_dif_minutes'</span>] <span class="op">&lt;</span> <span class="dv">0</span>].index)</span>
<span id="cb101-546"><a href="#cb101-546" aria-hidden="true" tabindex="-1"></a>vessels_going_too_fast</span>
<span id="cb101-547"><a href="#cb101-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-548"><a href="#cb101-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-551"><a href="#cb101-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb101-552"><a href="#cb101-552" aria-hidden="true" tabindex="-1"></a>shipping_impact_minutes <span class="op">=</span> vessels_going_too_fast[<span class="st">'time_dif_minutes'</span>].<span class="bu">sum</span>()</span>
<span id="cb101-553"><a href="#cb101-553" aria-hidden="true" tabindex="-1"></a>shipping_impact_days <span class="op">=</span> <span class="bu">round</span>(shipping_impact_minutes <span class="op">/</span> ( <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span>), <span class="dv">2</span>)</span>
<span id="cb101-554"><a href="#cb101-554" aria-hidden="true" tabindex="-1"></a>shipping_impact_days</span>
<span id="cb101-555"><a href="#cb101-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb101-556"><a href="#cb101-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-557"><a href="#cb101-557" aria-hidden="true" tabindex="-1"></a>**A 10-knot reduced speed zone in the identified whale habitat will increase travel time by approximately 27.88 days.**</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->


</body></html>